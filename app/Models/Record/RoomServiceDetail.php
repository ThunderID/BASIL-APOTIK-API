<?php

namespace App\Models\Record;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Validation\Rule;
use DB;
use Illuminate\Database\Eloquent\SoftDeletes;

class RoomServiceDetail extends Model
{
	use SoftDeletes;
    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// TRAITS
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// VARIABLES
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	protected $fillable = [
		'room_service_id',
		'room_item_id',
		'pos_product_id',
		'qty',
		'amount',
		'send_at',
		'completed_at',
	];

	public $timestamps = true;

	protected $hidden = [
	];

	protected $casts = [
	];

	protected $dates = [
		'deleted_at',
		'send_at',
		'completed_at'
	];

	protected $touches = [
	];

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// BOOT
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// CONSTRUCT
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// RELATIONSHIP
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function room()
	{
		return $this->belongsTo(\App\Room::class);
	}

	public function room_service()
	{
		return $this->belongsTo(RoomService::class);
	}

	public function room_item()
	{
		return $this->belongsTo(\App\Models\Pricing\RoomItem::class);
	}

	public function pos_product()
	{
		return $this->belongsTo(\Thunderlabid\POS\Product::class);
	}


	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// BOOT
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// STATIC FUNCTION
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// FUNCTION
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function getRules()
	{
		$rules['room_service_id']	= ['required', 'integer', 'exists:'. app()->make(RoomService::class)->getTable() . ',id'];
		$rules['room_item_id']		= ['nullable', 'required_without:pos_product_id', 'integer', 'exists:'. app()->make(\App\Models\Pricing\RoomItem::class)->getTable() . ',id'];
		$rules['pos_product_id']	= ['nullable', 'integer', 'exists:'. app()->make(\Thunderlabid\POS\Product::class)->getTable() . ',id'];
		
		$rules['amount']= ['nullable', 'numeric', 'min:0'];
		$rules['qty']  	= ['required', 'numeric', 'min:0'];

		$rules['send_at']  		= ['nullable', 'date'];
		$rules['completed_at']	= ['nullable', 'date'];
		
		return $rules;
	}
		
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// ACCESSOR
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// MUTATOR
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// QUERY
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
}
