<?php

namespace Thunderlabid\HR;

// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// LARAVEL
// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;
use Illuminate\Validation\Rule;

class Absent extends Model
{
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// TRAITS
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// VARIABLES
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	protected $table = 'hr_absents';
	public $timestamps = true;
	protected $fillable = [
		'date', 
		'at', 
		'org_id', 
		'user_id', 
		'is_in_office', 
		'geolocation', 
		'status', 
	];

	protected $hidden = [
	];

	protected $casts = [
		'geolocation'	=> 'array'
	];

	protected $dates = [
		'deleted_at', 'date'
	];

	protected $touches = [
	];

	protected $observables = [
	];

	protected $appends = [
	];

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// CONFIGURATIONS
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// BOOT
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// CONSTRUCT
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// RELATIONSHIP
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function user() {
		return $this->belongsTo(\App\User::class);
	}
	public function org() {
		return $this->belongsTo(\App\Org::class);
	}

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// BOOTx
	// ---------------------------------------------------------------------------------x-----------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// STATIC FUNCTION
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// FUNCTION
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function getRules()
	{
		$rules['date']               = ['required', 'date'];
		$rules['at']               	 = ['required', 'string'];
		$rules['status']             = ['required', 'string'];
		$rules['is_in_office']		 = ['required', 'boolean'];
		$rules['org_id']		 	 = ['required', 'integer', 'exists:'. app()->make(\App\Org::class)->getTable() . ',id'];
		$rules['user_id']		 	 = ['required', 'integer', 'exists:'. app()->make(\App\User::class)->getTable() . ',id'];
		$rules['geolocation']		 = ['required', 'array'];
		
		return $rules;
	}
	
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// ACCESSOR
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// MUTATOR
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	// QUERY
	// --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	public function scopeDateLt ($q, \Carbon\Carbon $v) 
	{
		return $q->where('date', '<', $v);
	}

	public function scopeDateLte ($q, \Carbon\Carbon $v) 
	{
		return $q->where('date', '<=', $v);
	}

	public function scopeDateGt ($q, \Carbon\Carbon $v) 
	{
		return $q->where('date', '>', $v);
	}

	public function scopeDateGte ($q, \Carbon\Carbon $v) 
	{
		return $q->where('date', '>=', $v);
	}	
}